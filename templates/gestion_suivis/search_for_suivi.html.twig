{% extends 'base.html.twig' %}

{% block title %}
    Ajouter un suivi de {{ type == 'signal' ? 'signal' : 'fait marquant' }}
{% endblock %}

{% block body %}
<div class="container-fluid mt-4">
    <h1 class="mb-4">
        Rechercher un {{ type == 'signal' ? 'signal' : 'fait marquant' }} à ajouter à la réunion du {{ reunion.DateReunion|format_datetime('long', 'none', locale='fr') }}
    </h1>

    <div class="card bg-light mb-4">
        <div class="card-body">
            {{ form_start(form) }}
            <div class="row g-3 mb-3">
                <div class="col-md-3">{{ form_row(form.Titre) }}</div>
                <div class="col-md-3">{{ form_row(form.Description) }}</div>
                <div class="col-md-3">{{ form_row(form.Indication) }}</div>
                <div class="col-md-3">{{ form_row(form.Contexte) }}</div>
            </div>
            <div class="row g-3">
                <div class="col-md-3">{{ form_row(form.dci) }}</div>
                <div class="col-md-3">{{ form_row(form.denomination) }}</div>
                <div class="col-md-3">{{ form_row(form.dateReunionDebut) }}</div>
                <div class="col-md-3">{{ form_row(form.dateReunionFin) }}</div>
            </div>
            <div class="mt-3 d-flex justify-content-center gap-5">
                {{ form_widget(form.recherche) }}
                {{ form_widget(form.reset) }}
                {{ form_widget(form.annulation) }}
            </div>
            {{ form_end(form) }}
        </div>
    </div>

    {% if signaux is defined and signaux is not empty %}
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>Titre</th>
                    <th>Description</th>
                    <th>Date Création</th>
                    <th>Statut</th>
                    <th class="text-center">Action</th>
                </tr>
            </thead>
            <tbody>
                {% for signal in signaux %}
                    <tr>
                        <td>{{ signal.Titre }}</td>
                        <td>{{ signal.DescriptionSignal|u.truncate(150, '...') }}</td>
                        <td>{{ signal.createdAt|format_datetime('short', 'none', locale='fr') }}</td>
                        <td>
                            {% set statutActif = null %}
                            {% for statut in signal.statutSignals %}
                                {% if statut.StatutActif %}
                                    {% set statutActif = statut %}
                                {% endif %}
                            {% endfor %}
                            <span class="badge bg-{{ statutActif and statutActif.libStatut == 'cloture' ? 'danger' : 'success' }}">
                                {{ statutActif ? statutActif.libStatut|replace({'_': ' '})|capitalize : 'N/A' }}
                            </span>
                        </td>
                        <td class="text-center">
                            <a href="{{ path('app_reunion_create_suivi', {'reunionId': reunion.id, 'signalId': signal.id}) }}" class="btn btn-sm btn-primary">
                                <i class="bi bi-plus-circle me-1"></i> Créer un suivi
                            </a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="navigation">
            {{ knp_pagination_render(signaux) }}
        </div>

    {% elseif app.request.method == 'GET' and app.request.query.count > 0 %}
        <div class="alert alert-warning text-center" role="alert">
            Aucun {{ type == 'signal' ? 'signal' : 'fait marquant' }} ne correspond à votre recherche ou ne peut être ajouté à cette réunion.
        </div>
    {% endif %}
</div>
{% endblock %}
