<div class="container-md">
    {{ form_start(form) }}
    <div class="row">
        <div class="col-2">
            {{ form_label(form.statutReunion) }}
        </div>
        <div class="col-2">
            {{ form_widget(form.statutReunion) }}
        </div>
        {# <div class="col-5">
            {{ form_row(form.fichiers) }}
        </div> #}
    </div>
    <div class="row mt-3">
        <div class="col-12">
            {{ form_row(form.Commentaire) }}
        </div>
        {# <div class="col-5">
            {{ form_row(form.fichiers) }}
        </div> #}
    </div>

    {# Nouvelle section pour les liens de la réunion avec Stimulus #}

    <div class="card mt-4 shadow-sm" data-controller="liens-reunion-signal">
        <div class="card-header bg-primary text-white">
            <h5 class="card-title mb-0">
                <i class="bi bi-link-45deg"></i> Liens de la réunion
            </h5>
        </div>
        <div class="card-body">
            {# Le conteneur de la liste, maintenant avec un prototype propre #}
            <div data-liens-reunion-signal-target="list"
                data-prototype="{{ include('reunion_signal_detail/_lien_reunion_signal_item.html.twig', {form: form.liensReunionsSignals.vars.prototype})|e('html_attr') }}"
                data-liens-reunion-signal-widget-counter-value="{{ form.liensReunionsSignals|length }}">

                {# Boucle pour afficher les formulaires existants #}
                {% for lienField in form.liensReunionsSignals %}
                    {{ include('reunion_signal_detail/_lien_reunion_signal_item.html.twig', {form: lienField}) }}
                {% endfor %}
            </div>

            {# Le bouton pour ajouter un nouvel élément #}
            <button type="button" class="btn btn-success add-lien-button mt-3" data-action="liens-reunion-signal#add">
                <i class="bi bi-plus-circle"></i> Ajouter un lien
            </button>
        </div>
    </div>

    <!-- Card Fichiers Attachés -->
    <div class="col-12">
        <div class="card mt-4 shadow-sm"> {# Ajout de mt-4 pour espacer les cartes #}
            <div class="card-header bg-info text-white">
                <h5 class="card-title mb-0">
                    <i class="bi bi-paperclip"></i> Fichiers Attachés
                </h5>
            </div>
            <div class="card-body">

                <div class="mb-3">
                    {{ form_row(form.fichiers) }}
                </div>

                {% if fichiersLies is not empty %}
                    <ul class="list-group mb-4">
                        {% for fichier in fichiersLies %}
                            {# AJOUT ICI DU data-controller sur le li #}
                            <li class="list-group-item d-flex justify-content-between align-items-center"
                                data-controller="fichiers-attaches-reunion-signal"
                                data-fichiers-attaches-reunion-signal-url-value="{{ path('app_reunion_signal_fichier_delete', {'id': fichier.id}) }}"
                                data-fichiers-attaches-reunion-signal-token-value="{{ csrf_token('delete' ~ fichier.id) }}"
                                data-fichiers-attaches-reunion-signal-confirm-message-value="Êtes-vous sûr de vouloir supprimer le fichier suivant ?" {# Message mis à jour #}
                                data-fichiers-attaches-reunion-signal-file-name-value="{{ fichier.nomOriginal }}"> {# Nouveau data-value #}
                                <div class="d-flex align-items-center"> {# Nouveau conteneur pour le lien et le texte #}
                                    <a href="{{ path('app_reunion_signal_fichier_download', {'id': fichier.id}) }}" target="_blank">
                                        <i class="bi bi-file-earmark"></i> {{ fichier.nomOriginal }}
                                    </a>
                                    {# Utilisation de 'ms-2' pour une marge à gauche, séparant du lien #}
                                    <span class="text-muted small ms-2"> - {{ (fichier.taille / 1024 / 1024)|number_format(2, '.', ',') }} Mo - Uploadé le {{ fichier.createdAt|date('d/m/Y à H:i') }} par {{ fichier.userCreate }}</span>
                                </div>
                                


                                {% if is_granted('ROLE_REUSI_ADMIN') %}
                                    <button type="button" class="btn btn-sm btn-danger"
                                            data-action="click->fichiers-attaches-reunion-signal#delete"> {# Action Stimulus #}
                                        <i class="bi bi-trash"></i> Supprimer
                                    </button>
                                {% endif %}		

                                {# Bouton de suppression avec formulaire CSRF #}
                                {# <form method="post" action="{{ path('app_reunion_signal_fichier_delete', {'id': fichier.id}) }}" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer ce fichier ?');" class="d-inline">
                                    <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ fichier.id) }}">
                                    {% if is_granted('ROLE_REUSI_ADMIN') %}
                                        <button type="submit" class="btn btn-sm btn-danger">
                                            <i class="bi bi-trash"></i> Supprimer
                                        </button>
                                    {% endif %}
                                </form> #}
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>Aucun fichier attaché à cette réunion.</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="mt-3 d-flex justify-content-center">
        {{ form_row(form.save) }}
    </div>    

    {{ form_end(form) }}

</div>
