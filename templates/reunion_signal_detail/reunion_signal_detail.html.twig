{% extends 'base.html.twig' %}

{% block title %}Détail de la réunion du {{ reunionSignal.DateReunion ? reunionSignal.DateReunion|format_datetime('long', 'none', locale='fr') : 'N/A' }}{% endblock %}

{% block body %}

	{# Affichage des messages flash #}
    {% for type, messages in app.flashes %}
        {% for message in messages %}
            <div class="alert alert-{{ type }}">{{ message }}</div>
        {% endfor %}
    {% endfor %}

{{ encore_entry_link_tags('reunion_signal_detail_css') }}

<div class="container-fluid mt-4 page-reunion-signal-detail">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <h1 class="mb-0">Réunion du {{ reunionSignal.DateReunion ? reunionSignal.DateReunion|format_datetime(dateFormat='long', timeFormat='none', locale='fr') : 'N/A' }}</h1>
            <span class="text-muted">{{ reunionSignal.DateReunion ? reunionSignal.DateReunion|format_datetime(pattern="EEEE", timeFormat='none', locale='fr')|capitalize : '' }}</span>
        </div>
        <div class="actions-container" style="min-width: 450px;">
            <div class="row row-cols-2 g-2">
                <div class="col d-grid">
                    <a href="{{ path('app_signal_new', {'reunionId': reunionSignal.id, 'routeSource': 'app_reunion_signal_detail', 'params': {'reuSiId': reunionSignal.id, 'tab': currentTab}}) }}" class="btn btn-primary">
                        <i class="bi bi-file-earmark-plus me-1"></i> Créer un nouveau signal
                    </a>
                </div>
                <div class="col d-grid">
                    <a href="{{ path('app_reunion_add_suivi_signal', {'reunionId': reunionSignal.id, 'routeSource': 'app_reunion_signal_detail', 'params': {'reuSiId': reunionSignal.id, 'tab': currentTab}}) }}" class="btn btn-outline-primary">
                        <i class="bi bi-plus-circle me-1"></i> Ajouter un suivi de signal
                    </a>
                </div>
                <div class="col d-grid">
                    <a href="{{ path('app_fait_marquant_new', {'reunionId': reunionSignal.id, 'routeSource': 'app_reunion_signal_detail', 'params': {'reuSiId': reunionSignal.id, 'tab': currentTab}}) }}" class="btn btn-info">
                        <i class="bi bi-file-earmark-plus-fill me-1"></i> Créer un nouveau fait marquant
                    </a>
                </div>
                <div class="col d-grid">
                    <a href="{{ path('app_reunion_add_suivi_fm', {'reunionId': reunionSignal.id, 'routeSource': 'app_reunion_signal_detail', 'params': {'reuSiId': reunionSignal.id, 'tab': currentTab}}) }}" class="btn btn-outline-info">
                        <i class="bi bi-plus-circle-fill me-1"></i> Ajouter un suivi de fait marquant
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Nav tabs -->
    <ul class="nav nav-tabs" id="reunionTab" role="tablist">
        <li class="nav-item" role="presentation">
            <a class="nav-link {% if currentTab == 'nouveaux-signaux' %}active{% endif %}" href="{{ path('app_reunion_signal_detail', {'reuSiId': reunionSignal.id, 'tab': 'nouveaux-signaux'}) }}">
                Nouveaux Signaux <span class="badge rounded-pill bg-secondary badge-count">{{ nouveauxSignaux|length }}</span>
            </a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link {% if currentTab == 'suivis-signaux' %}active{% endif %}" href="{{ path('app_reunion_signal_detail', {'reuSiId': reunionSignal.id, 'tab': 'suivis-signaux'}) }}">
                Suivis de Signaux <span class="badge rounded-pill bg-secondary badge-count">{{ suivisSignaux|length }}</span>
            </a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link {% if currentTab == 'nouveaux-fm' %}active{% endif %}" href="{{ path('app_reunion_signal_detail', {'reuSiId': reunionSignal.id, 'tab': 'nouveaux-fm'}) }}">
                Nouveaux Faits Marquants <span class="badge rounded-pill bg-secondary badge-count">{{ nouveauxFaitsMarquants|length }}</span>
            </a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link {% if currentTab == 'suivis-fm' %}active{% endif %}" href="{{ path('app_reunion_signal_detail', {'reuSiId': reunionSignal.id, 'tab': 'suivis-fm'}) }}">
                Suivis de Faits Marquants <span class="badge rounded-pill bg-secondary badge-count">{{ suivisFaitsMarquants|length }}</span>
            </a>
        </li>
    </ul>

    <!-- Tab panes -->
    <div class="tab-content p-3" id="reunionTabContent">
        {% if currentTab == 'nouveaux-signaux' %}
            {% if nouveauxSignaux is not empty %}
                {% for suivi in nouveauxSignaux %}
                    {% include 'reunion_signal_detail/_suivi_card.html.twig' with { 'suivi': suivi } %}
                {% endfor %}
            {% else %}
                <div class="alert alert-light text-center" role="alert">
                    Aucun nouveau signal pour cette réunion.
                </div>
            {% endif %}
        {% elseif currentTab == 'suivis-signaux' %}
            {% if suivisSignaux is not empty %}
                {% for suivi in suivisSignaux %}
                    {% include 'reunion_signal_detail/_suivi_card.html.twig' with { 'suivi': suivi } %}
                {% endfor %}
            {% else %}
                <div class="alert alert-light text-center" role="alert">
                    Aucun suivi de signal pour cette réunion.
                </div>
            {% endif %}
        {% elseif currentTab == 'nouveaux-fm' %}
            {% if nouveauxFaitsMarquants is not empty %}
                {% for suivi in nouveauxFaitsMarquants %}
                    {% include 'reunion_signal_detail/_suivi_card.html.twig' with { 'suivi': suivi } %}
                {% endfor %}
            {% else %}
                <div class="alert alert-light text-center" role="alert">
                    Aucun nouveau fait marquant pour cette réunion.
                </div>
            {% endif %}
        {% elseif currentTab == 'suivis-fm' %}
            {% if suivisFaitsMarquants is not empty %}
                {% for suivi in suivisFaitsMarquants %}
                    {% include 'reunion_signal_detail/_suivi_card.html.twig' with { 'suivi': suivi } %}
                {% endfor %}
            {% else %}
                <div class="alert alert-light text-center" role="alert">
                    Aucun suivi de fait marquant pour cette réunion.
                </div>
            {% endif %}
        {% endif %}
    </div>
</div>
{% endblock %}