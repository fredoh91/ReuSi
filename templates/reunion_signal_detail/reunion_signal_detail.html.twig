{% extends 'base.html.twig' %}

{% block title %}Détail de la réunion du {{ reunionSignal.DateReunion ? reunionSignal.DateReunion|format_datetime('long', 'none', locale='fr') : 'N/A' }}{% endblock %}

{% block body %}

	{# Affichage des messages flash #}
    {% for type, messages in app.flashes %}
        {% for message in messages %}
            <div class="alert alert-{{ type }}">{{ message }}</div>
        {% endfor %}
    {% endfor %}

{{ encore_entry_link_tags('reunion_signal_detail_css') }}
{{ encore_entry_script_tags('reunion_signal_detail_js') }}

<div class="container-fluid mt-4 page-reunion-signal-detail">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <h1 class="mb-0">Réunion du {{ reunionSignal.DateReunion ? reunionSignal.DateReunion|format_datetime(dateFormat='long', timeFormat='none', locale='fr') : 'N/A' }}</h1>
            <span class="text-muted">{{ reunionSignal.DateReunion ? reunionSignal.DateReunion|format_datetime(pattern="EEEE", timeFormat='none', locale='fr')|capitalize : '' }}</span>
        </div>
        <div>
            {# TODO: Ajouter les boutons d'action ici #}
            <a href="#" class="btn btn-primary"><i class="bi bi-plus-circle me-1"></i> Ajouter un suivi</a>
            <a href="{{ path('app_signal_new') }}" class="btn btn-outline-primary"><i class="bi bi-file-earmark-plus me-1"></i> Créer un nouveau signal</a>
        </div>
    </div>

    <!-- Nav tabs -->
    <ul class="nav nav-tabs" id="reunionTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="nouveaux-signaux-tab" data-bs-toggle="tab" data-bs-target="#nouveaux-signaux" type="button" role="tab" aria-controls="nouveaux-signaux" aria-selected="true">
                Nouveaux Signaux <span class="badge rounded-pill bg-secondary badge-count">{{ nouveauxSignaux|length }}</span>
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="suivis-signaux-tab" data-bs-toggle="tab" data-bs-target="#suivis-signaux" type="button" role="tab" aria-controls="suivis-signaux" aria-selected="false">
                Suivis de Signaux <span class="badge rounded-pill bg-secondary badge-count">{{ suivisSignaux|length }}</span>
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="nouveaux-fm-tab" data-bs-toggle="tab" data-bs-target="#nouveaux-fm" type="button" role="tab" aria-controls="nouveaux-fm" aria-selected="false">
                Nouveaux Faits Marquants <span class="badge rounded-pill bg-secondary badge-count">{{ nouveauxFaitsMarquants|length }}</span>
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="suivis-fm-tab" data-bs-toggle="tab" data-bs-target="#suivis-fm" type="button" role="tab" aria-controls="suivis-fm" aria-selected="false">
                Suivis de Faits Marquants <span class="badge rounded-pill bg-secondary badge-count">{{ suivisFaitsMarquants|length }}</span>
            </button>
        </li>
    </ul>

    <!-- Tab panes -->
    <div class="tab-content p-3" id="reunionTabContent">
        <div class="tab-pane fade show active" id="nouveaux-signaux" role="tabpanel" aria-labelledby="nouveaux-signaux-tab">
            {% if nouveauxSignaux is not empty %}
                {% for suivi in nouveauxSignaux %}
                    {% include 'reunion_signal_detail/_suivi_card.html.twig' with { 'suivi': suivi } %}
                {% endfor %}
            {% else %}
                <div class="alert alert-light text-center" role="alert">
                    Aucun nouveau signal pour cette réunion.
                </div>
            {% endif %}
        </div>
        <div class="tab-pane fade" id="suivis-signaux" role="tabpanel" aria-labelledby="suivis-signaux-tab">
            {% if suivisSignaux is not empty %}
                {% for suivi in suivisSignaux %}
                    {% include 'reunion_signal_detail/_suivi_card.html.twig' with { 'suivi': suivi } %}
                {% endfor %}
            {% else %}
                <div class="alert alert-light text-center" role="alert">
                    Aucun suivi de signal pour cette réunion.
                </div>
            {% endif %}
        </div>
        <div class="tab-pane fade" id="nouveaux-fm" role="tabpanel" aria-labelledby="nouveaux-fm-tab">
            {% if nouveauxFaitsMarquants is not empty %}
                {% for suivi in nouveauxFaitsMarquants %}
                    {% include 'reunion_signal_detail/_suivi_card.html.twig' with { 'suivi': suivi } %}
                {% endfor %}
            {% else %}
                <div class="alert alert-light text-center" role="alert">
                    Aucun nouveau fait marquant pour cette réunion.
                </div>
            {% endif %}
        </div>
        <div class="tab-pane fade" id="suivis-fm" role="tabpanel" aria-labelledby="suivis-fm-tab">
            {% if suivisFaitsMarquants is not empty %}
                {% for suivi in suivisFaitsMarquants %}
                    {% include 'reunion_signal_detail/_suivi_card.html.twig' with { 'suivi': suivi } %}
                {% endfor %}
            {% else %}
                <div class="alert alert-light text-center" role="alert">
                    Aucun suivi de fait marquant pour cette réunion.
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}